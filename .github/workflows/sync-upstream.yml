name: Sync Fork with Upstream

on:
  # 允许在GitHub网页上手动触发此工作流
  workflow_dispatch:
  # 或者设置定时自动同步，例如每天UTC时间午夜运行
  schedule:
    - cron:  '0 0 * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：检出你的Fork仓库代码
      - name: Checkout
        uses: actions/checkout@v4

      # 步骤2：配置Git用户信息
      - name: Setup Git
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@users.noreply.github.com"

      # 步骤3：从上游仓库获取更新并合并
      - name: Sync Upstream
        run: |
          # 检查是否已存在 upstream 远程
          if ! git remote | grep -q upstream; then
            git remote add upstream https://github.com/ValueCell-ai/valuecell.git
          fi
          
          git fetch upstream
          # 将上游仓库的main分支合并到本地的main分支
          git merge upstream/main --allow-unrelated-histories
          
          # 如果有冲突，设置合并策略
          git config pull.rebase false
          
          git push origin main
      
